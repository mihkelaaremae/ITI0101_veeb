!function(){class v{#sounds={};#sheets={};#sprite_data={};#sprites=[];#canvas=null;#ctx=null;#size=P(256,256);#pixel_scale=2;#user_draw=null;#user_draw_front=null;#user_tick=null;#keys_pressed={};#keys_down={};constructor(){this.#init_input()}set_size(e){this.#size=P(e)}set_pixel_scale(e){this.#pixel_scale=e}add_sheet(e,t){this.#sheets[e]={name:e,filename:t,image:null}}add_sound(t,s){this.#sounds[t]={objects:[],head:0};for(let e=0;e<10;e++)this.#sounds[t].objects.push(new Audio(s))}add_sprite(e,t=P(),s=!0){var a=new r(this);return a.name=e,a.location=t,a.loop=s,this.#sprites.push(a),a}add_sprite_data(e,t){this.#sprite_data[e]=t}fill_rect(e,t,s){var a=this.#pixel_scale;this.#ctx.fillStyle=s,this.#ctx.fillRect(e.x*a,e.y*a,t.x*a,t.y*a)}draw_sprite(e,t=0,s=P(),a=!1,r=!1,i=0){!this.#sprite_data.hasOwnProperty(e)||this.#sprite_data[e].frames.length<=t||this.#sheets.hasOwnProperty(this.#sprite_data[e].frames[t].sheet)&&(e=I(E(s,(s=this.#sprite_data[e].frames[t]).dest),this.#pixel_scale),t=I(s.size,this.#pixel_scale),this.#ctx.save(),this.#ctx.translate(Math.floor(e.x+t.x/2),Math.floor(e.y+t.y/2)),this.#ctx.rotate(90*i*Math.PI/180),this.#ctx.translate(-Math.floor(e.x+t.x/2),-Math.floor(e.y+t.y/2)),this.#ctx.scale(a?-1:1,r?-1:1),this.#ctx.drawImage(this.#sheets[s.sheet].image,s.source.x,s.source.y,s.size.x,s.size.y,Math.floor(e.x)*(a?-1:1)-t.x*a,Math.floor(e.y)*(r?-1:1)-t.y*r,Math.floor(t.x),Math.floor(t.y)),this.#ctx.restore())}play_sound(e){this.#sounds[e].objects[this.#sounds[e].head].play(),this.#sounds[e].head++,this.#sounds[e].head%=10}on_draw(e){this.#user_draw=e}on_draw_front(e){this.#user_draw_front=e}on_tick(e){this.#user_tick=e}key_pressed(e){return 1===this.#keys_pressed[e]}key_down(e){return 1===this.#keys_down[e]}run(){null==this.#canvas&&this.#init_canvas();for(var[e,t]of Object.entries(this.#sheets))if(null===t.image)return t.image=new Image,t.image.onload=function(e){return function(){e.run()}}(this),void(t.image.src=t.filename);this.#request_frame()}get_frame_length(e,t){return!this.#sprite_data.hasOwnProperty(e)||this.#sprite_data[e].frames.length<=t?1:this.#sprite_data[e].frames[t].length}get_frame_count(e){return this.#sprite_data.hasOwnProperty(e)?this.#sprite_data[e].frames.length:1}#draw_sprites(){this.#sprites.forEach(e=>{e.tick(1/60)}),this.#sprites.forEach(e=>{e.draw()})}#frame(){null!==this.#user_tick&&this.#user_tick(),this.#ctx.clearRect(0,0,this.#canvas.width,this.#canvas.height),this.#ctx.imageSmoothingEnabled=!1,null!==this.#user_draw&&this.#user_draw(),this.#draw_sprites(),null!==this.#user_draw_front&&this.#user_draw_front(),this.#request_frame()}#request_frame(){var e;window.requestAnimationFrame((e=this,function(){e.#frame()}))}#init_input(){var t,s;document.onkeydown=(t=this,function(e){e.repeat||(t.#keys_pressed[e.code]=1),t.#keys_down[e.code]=1}),document.onkeyup=(s=this,function(e){s.#keys_down[e.code]=0})}#init_canvas(){this.#canvas=document.createElement("canvas"),this.#canvas.width=this.#size.x*this.#pixel_scale,this.#canvas.height=this.#size.y*this.#pixel_scale,this.#canvas.style["image-rendering"]="pixelated",document.body.appendChild(this.#canvas),this.#ctx=this.#canvas.getContext("2d")}}document.addEventListener("DOMContentLoaded",()=>{function o(e){"ball_break"!=e.name&&(e.restart(.55<Math.random()?"ball_0":"ball_1"),e.hflip=.5<Math.random(),e.vflip=.5<Math.random(),e.rotate=Math.floor(4*Math.random()),e.rate=.75+.5*Math.random(),w=E(w,P(2*(Math.random()-.5),.5*(Math.random()-.5))),300<Math.sqrt(w.x*w.x+w.y*w.y+w.z*w.z))&&(w.x*=.95,w.y*=.95)}function e(){var e,t;"bunny_cry"!=g.name?x.location=E(g.location,P((16-d)/2+y*h*3,3-l)):x.location=P(99999,99999),1==M&&(e=m.key_down("KeyA"),(t=m.key_down("KeyD"))&&!e?(y+=10,g.hflip=!1):e&&!t?(y-=10,g.hflip=!0):t&&e?0<y?y-=50*h:y+=50*h:0<y?(y-=2.5)<0&&(y=0):0<(y+=2.5)&&(y=0)),90<Math.abs(y)&&(y*=90/Math.abs(y)),Math.abs(y)<5&&(y=0),g.location=E(g.location,P(y*h,0)),g.location.x<u&&(g.location.x=u+1,m.play_sound("splat"),y=y<0?10-y:10),g.location.x>u+_-16&&(g.location.x=u+_-16-1,m.play_sound("splat"),y=0<y?-10-y:-10),b.location=E(b.location,I(w,h)),b.location.x<u&&(b.location.x=u+1,w.x*=-1,o(b),m.play_sound("bonk")),b.location.x>u+_-18&&(b.location.x=u+_-18-1,w.x*=-1,o(b),m.play_sound("bonk")),b.location.y<p&&(b.location.y=p+1,w.y*=-1,o(b),m.play_sound("bonk")),"ball_break"!=b.name&&b.location.y>p+c-18&&(b.location.y=p+c-17,w=P(),b.hflip=0,b.vflip=0,b.rotate=0,b.restart("ball_break"),m.play_sound("splat"),1==M)&&(g.restart("bunny_cry"),g.location.y+=3,M=2,k=0);for(let e=0;e<8;e++)if(function(e){if(e.x>=u&&e.y<=u+_&&e.y>=p&&e.y<=p+c){var t,s=Math.floor((e.x-u)/16),e=Math.floor((e.y-p)/8);if(!(e>=z.length))if(!(s>=z[e].length))return t=1==z[e][s],z[e][s]=0,t&&15==s&&0==e&&(M=3,k=0),t}}(P(b.location.x+9+18*Math.sin(2*Math.PI/8*e)/2,b.location.y+9+18*Math.cos(2*Math.PI/8*e)/2))){3==M?m.play_sound("free"):m.play_sound("break"),e%2&&(w.x*=-1,w.y*=-1),0!=e&&4!=e||(w.y*=-1),2!=e&&6!=e||(w.x*=-1);break}for(let e=0;e<16;e++)if("ball_break"!=b.name&&f<0&&(s=P(b.location.x+9+18*Math.sin(2*Math.PI/16*e)/2,b.location.y+9+18*Math.cos(2*Math.PI/16*e)/2)).x>=x.location.x&&s.y>=x.location.y&&s.x<=x.location.x+d&&s.y<=x.location.y+l){var s=b.location.x+9,a=b.location.y+9,r=x.location.x+d/2,i=x.location.y+l/2,n=Math.sqrt((s-r)*(s-r)+(a-i)*(a-i)),r=(r-s)/n,s=(i-a)/n,i=Math.sqrt(w.x*w.x+w.y*w.y);w.x=-r*i,w.y=-s*i,o(b),x.restart("carrot_jump"),m.play_sound("paddle"),f=.1;break}for(let e=0;e<10&&Math.sqrt(w.x*w.x+w.y*w.y)<100;e++)w=I(w,1.1)}function t(){w=P(0,130),g.location=P(u+(_-16)/2,p+c-19),n.location=P(u+_-8-2,p+4),i.location=P(u+_-8-21,p+4+24),r.location=P(u+_-8-12,p+4+24+21),z=[[1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1]],M=0,k=0,g.restart("bunny_stand"),x.restart("carrot_2"),b.restart("ball_0")}var s,a;const h=1/60,_=256,c=256,u=(512-_)/2,p=(384-c)/2,d=24,l=11;let f=-1,y=0,m=new v,g=(m.set_size(P(512,384)),m.add_sheet("sheet1","sheet.png"),m.add_sheet("bg","bg.png"),m.add_sheet("letter","letter.png"),m.add_sound("bonk","bonk.wav"),m.add_sound("break","break.wav"),m.add_sound("paddle","paddle.wav"),m.add_sound("free","free.wav"),m.add_sound("splat","splat.wav"),(s=m).add_sprite_data("bg",{frames:[{source:P(),size:P(128,128),dest:P(),length:.03,sheet:"bg"}]}),s.add_sprite_data("bunny_stand",{frames:[{source:P(),size:P(16,19),dest:P(),length:.03,sheet:"sheet1"}]}),s.add_sprite_data("bunny_walkr",{frames:q({source:P(0),size:P(16,19),dest:P(),length:.03,sheet:"sheet1"},6,16)}),s.add_sprite_data("bunny_walkl",{frames:q({source:P(96,0),size:P(16,19),dest:P(),length:.03,sheet:"sheet1"},5,16)}),s.add_sprite_data("bunny_cry",{frames:q({source:P(144,24),size:P(24,16),dest:P(),length:.35,sheet:"sheet1"},2,24)}),s.add_sprite_data("carrot_0",{frames:[{source:P(0,19),size:P(24,11),dest:P(),length:.03,sheet:"sheet1"}]}),s.add_sprite_data("carrot_1",{frames:[{source:P(24,19),size:P(24,11),dest:P(),length:.03,sheet:"sheet1"}]}),s.add_sprite_data("carrot_2",{frames:[{source:P(48,19),size:P(24,11),dest:P(),length:.03,sheet:"sheet1"}]}),s.add_sprite_data("carrot_3",{frames:[{source:P(72,19),size:P(24,11),dest:P(),length:.03,sheet:"sheet1"}]}),s.add_sprite_data("carrot_4",{frames:[{source:P(96,19),size:P(24,11),dest:P(),length:.03,sheet:"sheet1"}]}),s.add_sprite_data("carrot_jump",{frames:[{source:P(0,19),size:P(24,11),dest:P(),length:.03,sheet:"sheet1"},{source:P(0,19),size:P(24,11),dest:P(0,-3),length:.05,sheet:"sheet1"},{source:P(24,19),size:P(24,11),dest:P(0,-5),length:.06,sheet:"sheet1"},{source:P(24,19),size:P(24,11),dest:P(0,-6),length:.07,sheet:"sheet1"},{source:P(48,19),size:P(24,11),dest:P(0,-7),length:.06,sheet:"sheet1"},{source:P(72,19),size:P(24,11),dest:P(0,-7),length:.03,sheet:"sheet1"},{source:P(48,19),size:P(24,11),dest:P(0,-5),length:.06,sheet:"sheet1"},{source:P(24,19),size:P(24,11),dest:P(0,-4),length:.05,sheet:"sheet1"},{source:P(24,19),size:P(24,11),dest:P(0,-3),length:.03,sheet:"sheet1"},{source:P(0,19),size:P(24,11),dest:P(0,-1),length:.1,sheet:"sheet1"},{source:P(24,19),size:P(24,11),dest:P(0,-1),length:.1,sheet:"sheet1"},{source:P(48,19),size:P(24,11),dest:P(0,-1),length:.03,sheet:"sheet1"}]}),(a={frames:q({source:P(0,30),size:P(18,19),dest:P(),length:.09,sheet:"sheet1"},4,18)}).frames[3].length=.27,s.add_sprite_data("ball_0",a),s.add_sprite_data("ball_1",{frames:q({source:P(72,30),size:P(18,18),dest:P(),length:.11,sheet:"sheet1"},4,18)}),(a={frames:q({source:P(96,49),size:P(20,17),dest:P(),length:.06,sheet:"sheet1"},4,20)}).frames.push({source:P(136,49),size:P(20,17),dest:P(),length:99999999,sheet:"sheet1"}),s.add_sprite_data("ball_break",a),s.add_sprite_data("brick_0",{frames:[{source:P(0,72),size:P(16,8),dest:P(),length:.03,sheet:"sheet1"}]}),s.add_sprite_data("brick_1",{frames:[{source:P(0,80),size:P(16,8),dest:P(),length:.03,sheet:"sheet1"}]}),s.add_sprite_data("helpme",{frames:[{source:P(96,67),size:P(96,21),dest:P(),length:.03,sheet:"sheet1"}]}),s.add_sprite_data("safenow",{frames:[{source:P(48,96),size:P(96,24),dest:P(),length:.03,sheet:"sheet1"}]}),s.add_sprite_data("aletter",{frames:[{source:P(48,120),size:P(144,24),dest:P(),length:.03,sheet:"sheet1"}]}),s.add_sprite_data("pressr",{frames:[{source:P(48,144),size:P(112,24),dest:P(),length:.03,sheet:"sheet1"}]}),s.add_sprite_data("letter",{frames:[{source:P(),size:P(384,256),dest:P(),length:.03,sheet:"letter"}]}),s.add_sprite_data("3",{frames:[{source:P(48,48),size:P(16,24),dest:P(),length:.03,sheet:"sheet1"}]}),s.add_sprite_data("2",{frames:[{source:P(64,48),size:P(16,24),dest:P(),length:.03,sheet:"sheet1"}]}),s.add_sprite_data("1",{frames:[{source:P(80,48),size:P(16,24),dest:P(),length:.03,sheet:"sheet1"}]}),s.add_sprite_data("border_0",{frames:q({source:P(48,72),size:P(8,8),dest:P(),length:.35,sheet:"sheet1"},6,8)}),s.add_sprite_data("border_1",{frames:q({source:P(48,80),size:P(8,8),dest:P(),length:.35,sheet:"sheet1"},6,8)}),s.add_sprite_data("border_2",{frames:q({source:P(48,88),size:P(8,8),dest:P(),length:.35,sheet:"sheet1"},6,8)}),s.add_sprite_data("chain",{frames:[{source:P(43,96),size:P(5,24),dest:P(),length:.03,sheet:"sheet1"}]}),s.add_sprite_data("cage",{frames:[{source:P(0,96),size:P(42,48),dest:P(),length:.03,sheet:"sheet1"}]}),s.add_sprite_data("squirrel",{frames:[{source:P(0,48),size:P(24,24),dest:P(),length:.03,sheet:"sheet1"}]}),m.add_sprite("bunny_stand")),x=m.add_sprite("carrot_2"),b=m.add_sprite("ball_0"),r=m.add_sprite("squirrel"),i=m.add_sprite("cage"),n=m.add_sprite("chain"),w=P(110,110),z=[],M=0,k=10;g.on_end(()=>{1==M&&"bunny_cry"!=g.name&&(m.key_down("KeyA")^m.key_down("KeyD")?"bunny_walkl"==g.name?g.restart("bunny_walkr"):g.restart("bunny_walkl"):g.restart("bunny_stand"))}),x.on_end(()=>{Math.abs(y)<22.5?x.restart("carrot_2"):Math.abs(y)<45?0<y?x.restart("carrot_3"):x.restart("carrot_1"):0<y?x.restart("carrot_4"):x.restart("carrot_0")}),g.location=P(u+(_-16)/2,p+c-19),m.on_draw(()=>{for(let t=0;t<4;t++)for(let e=0;e<4;e++)m.draw_sprite("bg",0,P(128*t,128*e));m.fill_rect(P(u,p),P(_,c),"#40303b");for(let t=0;t<z.length;t++)for(let e=0;e<z[t].length;e++)0!=z[t][e]&&m.draw_sprite((4571*e+4651*t)%17<8?"brick_0":"brick_1",0,E(P(16*e,8*t),P(u,p)));for(let e=-8;e<_+8;e+=8){var t=e+8>=_+8,s=-8==e||t?0:1+524287*(e/8+15467)%4,a=-8==e||t?0:1+131071*(e/8+1)%4,r=6700417*(e/8+1)%3,i=2147483647*(e/8+1)%3;m.draw_sprite("border_"+r,s,E(P(e,0),P(u,p-8)),t),m.draw_sprite("border_"+i,a,E(P(e,c),P(u,p)),t)}for(let e=0;e<c;e+=8){var n=e+8>=c,o=0==e||n?0:1+5242871*(e/8+45671)%4,h=0==e||n?0:1+e/8*1310711%4,d=e/8*67004171%3,l=e/8*21474836471%3;m.draw_sprite("border_"+d,o,E(P(-8,e),P(u,p)),n,!1,1),m.draw_sprite("border_"+l,h,E(P(_,e),P(u,p)),n,!1,1)}0==M&&(k<3?m.draw_sprite("helpme",0,P(u+(_-96)/2+2.3*Math.sin(3*k),p+(c-21)/2+1.2*Math.cos(7.4*k))):k<4?m.draw_sprite("3",0,P(u+(_-16)/2,p+(c-24)/2+10*Math.pow(Math.E,k-4))):k<5?m.draw_sprite("2",0,P(u+(_-16)/2,p+(c-24)/2+10*Math.pow(Math.E,k-5))):k<6&&m.draw_sprite("1",0,P(u+(_-16)/2,p+(c-24)/2+10*Math.pow(Math.E,k-6)))),2==M&&1<k&&m.draw_sprite("pressr",0,P(u+(_-112)/2+2.3*Math.sin(3*k*.1),p+(c-24)/2+1.2*Math.cos(7.4*k*.1))),4==M&&1<k&&k<5&&m.draw_sprite("safenow",0,P(u+(_-96)/2+2.3*Math.sin(3*k),p+(c-24)/2+1.2*Math.cos(7.4*k))),4==M&&7<k&&k<11&&m.draw_sprite("aletter",0,P(u+(_-144)/2+2.3*Math.sin(3*k*1.5),p+(c-42)/2+1.2*Math.cos(7.4*k*1.7)))}),m.on_draw_front(()=>{4==M&&m.draw_sprite("letter",0,P(64,64+10*Math.pow(Math.max(16-k,0),2)))}),m.on_tick(()=>{k+=h,f-=h,0==M?(b.location=P(9999999),x.location=P(9999999),6<=k&&(M=1,k=0,b.location=P(u+(_-16)/2,p+(c-19)/2))):1==M?e():2==M?x.location=P(9999999):3==M?(e(),n.location.y+=9*k,i.location.y+=9*k,r.location.y+=9*k,y=0,g.hflip=!1,g.restart("bunny_stand"),r.location.y>=p+c-24&&(r.location.y=p+c-24,M=4,m.play_sound("splat"),k=0)):4==M&&(e(),n.location.y+=9*(k-.5),i.location.y+=9*(k-.5)),m.key_down("KeyR")&&(4==M&&1<k||2==M)&&t()}),m.run(),t()});class r{location=P();hflip=!1;vflip=!1;loop=!0;rotate=0;name="";rate=1;#engine=null;#frame=0;#frametime=0;#user_end=null;constructor(e){this.#engine=e}restart(e,t=0){this.name=e,this.#frametime=0,this.#frame=t}on_end(e){this.#user_end=e}draw(){this.#engine.draw_sprite(this.name,this.#frame,this.location,this.hflip,this.vflip,this.rotate)}tick(e){this.#frametime+=e*this.rate,this.#frametime>this.#engine.get_frame_length(this.name,this.#frame)&&(this.#frametime-=this.#engine.get_frame_length(this.name,this.#frame),this.#frame++,this.#frame%=this.#engine.get_frame_count(this.name),0==this.#frame)&&null!==this.#user_end&&this.#user_end()}}function q(t,s,a){var r=[];for(let e=0;e<s;e++)r.push({source:P(E(t.source,P(a*e,0))),size:P(t.size),dest:P(t.dest),length:t.length,sheet:t.sheet});return r}function P(e=null,t=null){return null===e?{x:0,y:0}:null===t?"number"==typeof e?{x:e,y:e}:{x:e.x,y:e.y}:{x:e,y:t}}function E(e,t){return"number"==typeof e?"number"==typeof t?e+t:{x:e+t.x,y:e+t.y}:"number"==typeof t?{x:e.x+t,y:e.y+t}:{x:e.x+t.x,y:e.y+t.y}}function I(e,t){return"number"==typeof e?"number"==typeof t?e*t:{x:e*t.x,y:e*t.y}:"number"==typeof t?{x:e.x*t,y:e.y*t}:{x:e.x*t.x,y:e.y*t.y}}}();
